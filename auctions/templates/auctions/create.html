{% extends "auctions/layout.html" %}

{% block body %}
    <style>
        ::placeholder {
            font-size: 0.8rem; /* Adjust the size as needed */
        }

        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .image-preview {
            position: relative;
            width: 100px;
            height: 100px;
            background-color: #cde0ec;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid black;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: cover;
        }

        .remove-img-btn {
            position: absolute;
            top: 5px; /* Adjust the distance from the top */
            right: 5px; /* Adjust the distance from the right */
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            cursor: pointer;
            padding: 0;
            font-size: 14px; /* Adjust the font size as needed */
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>

    <div style="padding-top: 100px;" class="d-flex justify-content-center align-items-center w-100">
        <div class="container" style="padding: 20px; margin-bottom: 100px;">
            <h2 class="text-center mb-4">Add Auction</h2>
            <form method="POST" action="" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Display error messages -->
                {% if messages %}
                    <div class="alert alert-danger">
                        <ul>
                            {% for message in messages %}
                                <li>{{ message }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                <div class="form-group">
                    <label for="title">Title</label>
                    <input required autofocus placeholder="Title" type="text" name="create_title" id="title"
                           class="form-control"/>
                </div>

                <div class="form-group">
                    <label for="desc">Description</label>
                    <textarea style="width: 100%" class="form-control" id="desc" rows="4"
                              placeholder="Add Description" name="create_desc"></textarea>
                </div>

                <div class="row justify-content-center">
                    <div class="col-12 col-md-4 mb-3">
                        <div class="form-group">
                            <label for="starting_bid">Starting Bid</label>
                            <input required placeholder="Starting bid amount" type="number" name="create_initial_bid"
                                   id="starting_bid" class="form-control"/>
                        </div>
                    </div>

                    <div class="col-12 col-md-4 mb-3">
                        <div class="form-group">
                            <label for="buy_now_price">Buy Now Price</label>
                            <input placeholder="Buy Now Price" type="number" name="create_buy_now_price"
                                   id="buy_now_price"
                                   class="form-control"/>
                        </div>
                    </div>

                    <div class="col-12 col-md-4 mb-3">
                        <div class="form-group">
                            <label for="expire_date">Expiration Date</label>
                            <input required placeholder="Expiration date" type="date" name="expire_date"
                                   id="expire_date"
                                   class="form-control"/>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="img_url">Upload Images</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="inputGroupFile04" name="img_url"
                               accept="image/*" multiple
                               onchange="previewImages(event)">
                        <label class="custom-file-label" for="inputGroupFile04">Choose Images</label>
                    </div>
                    <div class="image-preview-container mt-2" id="image_preview_container">
                        <!-- Image previews will be added here dynamically -->
                    </div>
                </div>

                <div class="form-group">
                    <label for="category_select">Select Category <span style="font-size: small">(You can select multiple category by holding down the Ctrl
                        key)</span></label>
                    <select name="category" id="category_select" class="form-select" multiple style="height: 200px;"
                            onchange="toggleNewCategoryField()">
                        {% for category in categories %}
                            <option class="p-2" value="{{ category.slug }}">{{ category.title }}</option>
                        {% endfor %}
                        <option value="new" class="p-2" style="font-style: italic;">Add New Category</option>
                    </select>
                </div>

                <!-- New category field (hidden by default) -->
                <div class="form-group" id="new_category_field" style="display:none;">
                    <label for="new_category_title">New Category Title</label>
                    <input placeholder="Enter new category title" type="text" name="new_category_title"
                           id="new_category_title" class="form-control"/>
                </div>

                <button class="btn btn-primary" type="submit">Submit</button>
            </form>

        </div>
    </div>

    <script>
        function toggleNewCategoryField() {
            const categorySelect = document.getElementById('category_select');
            const newCategoryField = document.getElementById('new_category_field');
            const selectedValue = categorySelect.value;

            if (selectedValue === 'new') {
                newCategoryField.style.display = 'block';
            } else {
                newCategoryField.style.display = 'none';
            }
        }

        tinymce.init({
            selector: '#desc',
            plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount linkchecker',
            toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat',
        });

        function previewImages(event) {
            const files = event.target.files;
            const container = document.getElementById('image_preview_container');
            container.innerHTML = '';

            Array.from(files).forEach(file => {
                if (file) {
                    const reader = new FileReader();
                    const div = document.createElement('div');
                    div.classList.add('image-preview');

                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.alt = 'Image Preview';

                    const btn = document.createElement('button');
                    btn.classList.add('remove-img-btn');
                    btn.innerText = 'Ã—';
                    btn.onclick = () => {
                        container.removeChild(div);
                        const dataTransfer = new DataTransfer();
                        Array.from(event.target.files).forEach((f, index) => {
                            if (f !== file) {
                                dataTransfer.items.add(f);
                            }
                        });
                        event.target.files = dataTransfer.files;
                    };

                    div.appendChild(img);
                    div.appendChild(btn);
                    container.appendChild(div);
                }
            });
        }
    </script>
{% endblock %}
